<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Western US Test & Range Sites — Satellite Map</title>

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;600&display=swap" rel="stylesheet">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="anonymous">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="anonymous"></script>

<style>
/* ===== THEME TOKENS ===== */
:root{
  --ink:#e9edf2;--muted:#9fb2c2;--accent:#1b4f72;
  --panel:#0f1720;--keyline:#1a2633;
  --pin-fill:#2E4053;            /* base pin */
  --pin-fill-hover:#3b556e;      /* hover tint (slightly lighter) */
}

/* ===== PAGE & TYPOGRAPHY ===== */
html,body{height:100%;}
body{
  margin:0;
  font-family:"IBM Plex Sans",system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  color:var(--ink);
  background:radial-gradient(1200px 600px at 50% -10%,#0f1620 0%,#0b0f14 60%,#091018 100%);
}

/* ===== SHELL & HEADER ===== */
.shell{max-width:1200px;margin:24px auto 48px;padding:0 16px;}
.titlebar{
  display:flex;align-items:baseline;justify-content:space-between;
  background:var(--panel);color:var(--ink);
  border:1px solid var(--keyline);
  border-radius:8px 8px 0 0;padding:12px 16px;
}
.titlebar .brand{display:flex;gap:10px;align-items:center;font-weight:600;letter-spacing:.2px;}
.titlebar .brand img{height:22px;filter:grayscale(100%);opacity:.9;}
.titlebar .meta{color:var(--muted);font-size:13px;}

/* ===== MAP FRAME (4:3) ===== */
.frame{
  border:1px solid var(--keyline);
  border-top:none;border-radius:0 0 8px 8px;
  background:#0a0f15;box-shadow:0 10px 30px rgba(0,0,0,.35);
  position:relative;overflow:hidden;
}
#map{
  width:100%;
  aspect-ratio:4/2;              /* modern browsers keep 4:3 */
  max-width:1200px;
}
/* Fallback for browsers without aspect-ratio */
@supports not (aspect-ratio: 4 / 3){
  #map{height:900px;}            /* 1200×900 (4:3) fallback */
  @media(max-width:1200px){
    #map{height:calc(50vw);}     /* ~4:3 as it shrinks */
  }
}

/* Optional technical corner ticks */
.frame::before,.frame::after{
  content:"";position:absolute;width:18px;height:18px;border:1px solid #1d2a37;
}
.frame::before{left:10px;top:10px;border-right:none;border-bottom:none;}
.frame::after{right:10px;bottom:10px;border-left:none;border-top:none;}

/* ===== LEGEND ===== */
.legend{
  display:inline-block;margin:10px 0 0;color:var(--muted);
  font-size:13px;background:rgba(12,18,26,.7);
  border:1px solid var(--keyline);border-radius:6px;
  padding:8px 10px;backdrop-filter:blur(2px);
}
.legend-row{display:flex;align-items:center;gap:8px;}
.legend-pin{
  width:10px;height:10px;border-radius:50%;
  background:var(--pin-fill);display:inline-block;position:relative;
}
.legend-pin::after{
  content:"";position:absolute;inset:-4px;
  border:2px solid var(--pin-fill);border-radius:50%;
  opacity:.7;
}

/* ===== LEAFLET THEMING ===== */
.leaflet-container a{color:var(--accent);}
.leaflet-control-attribution{background:rgba(255,255,255,.8);color:#12202c;}
.leaflet-control-zoom a{background:#14202b;color:#cfe2f3;border:1px solid #203040;}
.leaflet-control-zoom a:hover{background:#1b2a38;}
.leaflet-popup-content-wrapper{border-radius:6px;border:1px solid #dbe5ef;}
.leaflet-popup-content{margin:10px 12px;line-height:1.35;}

/* ===== HOTSPOT MARKER (SVG via divIcon) ===== */
.pin-wrap{
  width:26px;height:26px;           /* square hotspot */
  transform: translateZ(0);         /* enable GPU comp */
  will-change: filter, transform;
}
.pin-wrap svg{display:block;width:26px;height:26px;}
/* Inner dot + ring use currentColor for easy hover tint */
.pin-wrap{ color: var(--pin-fill); transition: color 160ms ease; }
.pin-wrap:hover{ color: var(--pin-fill-hover); }

/* Popup fade-in on open */
.popup-fade{opacity:0;animation:popupFade 220ms ease forwards;}
@keyframes popupFade{to{opacity:1;}}
.site-title{font-weight:600;margin:0 0 4px 0;font-size:15px;color:#12202c;}
.site-subtle{margin:0;font-size:13px;color:#233444;}

/* Accessibility: focus rings */
.leaflet-container a:focus{outline:2px solid #88b3d7;outline-offset:2px;}
</style>
</head>

<body>
<main class="shell">
  <header class="titlebar" role="banner">
    <div class="brand">
      <!-- <img src="emblem.svg" alt="" aria-hidden="true"> -->
      <span>Western US Test &amp; Range Sites</span>
    </div>
    <div class="meta">Ministry of Defence — Briefing</div>
  </header>

  <section class="frame">
    <div id="map" aria-label="Satellite map of selected defence and test sites in the western United States"></div>
  </section>

  <aside class="legend" aria-label="Map legend">
    <div class="legend-row">
      <span class="legend-pin"></span> Defence / Test Site
    </div>
  </aside>
</main>

<script>
/* ===== MAP: Esri World Imagery ===== */
const map=L.map('map',{zoomControl:true});
L.tileLayer(
  'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
  {
    attribution:'Tiles © Esri — Source: Esri, Maxar, Earthstar Geographics, and the GIS User Community',
    maxZoom:19
  }).addTo(map);

/* ===== DATA ===== */
const SITES=[
  {id:'china-lake',name:'Naval Air Weapons Station (NAWS) China Lake',coords:[35.6508,-117.6617]},
  {id:'nellis-afb',name:'Nellis Air Force Base',coords:[36.2406,-115.0543]},
  {id:'nas-point-mugu',name:'Naval Air Station (NAS) Point Mugu',coords:[34.1127,-119.1056]},
  {id:'uttr',name:'Utah Test and Training Range (UTTR)',coords:[40.6571,-113.4383]},
  {id:'ttr',name:'Tonopah Test Range (TTR)',coords:[37.78,-116.77]},
  {id:'mhrc',name:'Mountain Home Range Complex (MHRC)',coords:[42.754883,-115.575822]},
  {id:'wsmr',name:'White Sands Missile Range (WSMR)',coords:[33.2385,-106.3464]},
  {id:'yuma',name:'Yuma Proving Ground',coords:[32.8595,-114.4396]}
];

/* ===== HOTSPOT ICON (SVG via divIcon) =====
   - Uses currentColor for easy CSS hover tint
   - Inner dot + outer ring for visibility on imagery
*/
function makeHotspotIcon(id){
  const html=`
  <div class="pin-wrap" id="${id}" aria-hidden="true">
    <svg viewBox="0 0 24 24" role="img" aria-label="Location hotspot">
      <!-- outer ring -->
      <circle cx="12" cy="12" r="9" fill="none" stroke="currentColor" stroke-width="2" opacity="0.9"/>
      <!-- inner dot -->
      <circle cx="12" cy="12" r="4" fill="currentColor"/>
    </svg>
  </div>`;
  return L.divIcon({
    html,className:"",
    iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-14]
  });
}

/* ===== PLACE MARKERS & POPUPS ===== */
const markers=[],latlngs=[],closeTimers=new Map();

SITES.forEach(site=>{
  const icon=makeHotspotIcon(`pin-${site.id}`);
  const marker=L.marker(site.coords,{icon}).addTo(map);

  const popupHTML=`<h3 class="site-title">${site.name}</h3>
                   <p class="site-subtle">${site.coords[0].toFixed(5)}°, ${site.coords[1].toFixed(5)}°</p>`;

  marker.bindPopup(popupHTML,{className:'popup-fade',autoClose:false,closeButton:false,maxWidth:260});

  // Disable click-to-open; we’ll control popups via hover only
  marker.off('click');

  // Hover behavior — open on mouseover, close on mouseout (with small delay)
  marker.on('mouseover',()=>{
    clearTimeout(closeTimers.get(marker));
    marker.openPopup();
  });

  marker.on('mouseout',()=>{
    const t=setTimeout(()=>marker.closePopup(),180);
    closeTimers.set(marker,t);
  });

  // Keep popup open if user moves pointer into it; close when leaving popup
  marker.on('popupopen',e=>{
    const el=e.popup.getElement();
    if(!el) return;
    const clear=()=>clearTimeout(closeTimers.get(marker));
    const schedule=()=>{ const t=setTimeout(()=>marker.closePopup(),180); closeTimers.set(marker,t); };
    el.addEventListener('mouseenter',clear);
    el.addEventListener('mouseleave',schedule);
  });

  markers.push(marker);
  latlngs.push(site.coords);
});

if(latlngs.length) map.fitBounds(L.latLngBounds(latlngs),{padding:[28,28]}); else map.setView([39,-115],6);
</script>
</body>
</html>
